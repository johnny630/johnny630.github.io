<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <title>複利計算機</title>
    <script>
      function calculat_compound_interest () {
        $("#result tbody").html('');

        let principal = $("#principal").val() * 1;
        let interest = $("#interest").val() * 1;
        let interest_period = $("#interest_period").val();
        let money_per_period = $("#money_per_period").val() * 1;
        let deposit_years = $("#deposit_years").val() * 1;
        console.log(principal, interest, interest_period, money_per_period, deposit_years);


        let calculat_interest = interest_period === 'month' ? (interest/12).toFixed(6) : interest;
        let period_times = interest_period === 'month' ? deposit_years * 12 : deposit_years;

        let total_money = principal;
        let total_principal_money = principal;
        let total_interest_money = 0;

        for (let i = 1 ; i <= period_times ; i++) {
          let temp_interest_money = Math.round(total_money * (calculat_interest));
          total_interest_money += temp_interest_money;

          total_money = total_money + temp_interest_money;
          console.log(convert_period_str(i, interest_period) + ' / 總本金:' + total_principal_money + ' / 此次利息:' + temp_interest_money + ' / 總利息:' + total_interest_money + ' / 總金額:' + total_money);

          result_html = "<tr>";
          result_html += "<th scope='col'>"+ convert_period_str(i, interest_period) +"</th>";
          result_html += "<th scope='col'>"+ total_principal_money +"</th>";
          result_html += "<th scope='col'>"+ temp_interest_money +"</th>";
          result_html += "<th scope='col'>"+ total_interest_money +"</th>";
          result_html += "<th scope='col'>"+ total_money +"</th>";
          result_html += "</tr>";
          $("#result tbody").append(result_html);

          total_money += money_per_period;
          total_principal_money += money_per_period;
        }
      }

      function convert_period_str(num, period){
        if (period === 'month'){
          return parseInt(num/12) + ' 年 ' + (num%12) + ' 月';
        }else{
          return num + ' 年';
        }
      }
    </script>
  </head>
  <body>
    <div class="container">
      <h1>Hello, world!</h1>
      <div class="row">
        <div class="col-sm-3">
          <form>
            <div class="form-group">
              <label for="principal">本金</label>
              <input type="number" class="form-control" value="1000000" id="principal" name="principal" min="1">
            </div>
            <div class="form-group">
              <label for="interest">年利息</label>
              <select class="form-control" id="interest">
                <option value="0.01">1%</option>
                <option value="0.02">2%</option>
                <option value="0.03">3%</option>
                <option value="0.04">4%</option>
                <option value="0.05">5%</option>
                <option value="0.06">6%</option>
                <option value="0.07">7%</option>
                <option value="0.08">8%</option>
                <option value="0.09">9%</option>
                <option value="0.1">10%</option>
              </select>
            </div>
            <div class="form-group">
              <label for="interest_period">複利頻率</label>
              <select class="form-control" id="interest_period">
                <option value="month">每月</option>
                <option value="year">每年</option>
              </select>
            </div>
            <div class="form-group">
              <label for="money_per_period">每頻率再投入金額</label>
              <input type="number" class="form-control" value="50000" id="money_per_period" name="money_per_period" min="1">
            </div>
            <div class="form-group">
              <label for="deposit_years">計算年份</label>
              <input type="number" class="form-control" value="20" id="deposit_years" name="deposit_years" min="1">
            </div>
            
            <button type="button" class="btn btn-primary" onclick="calculat_compound_interest()">計算</button>
          </form>
        </div>
        
        <div class="col-sm-9">
          <table id="result" class="table table-striped table-dark">
            <thead>
              <tr>
                <th scope="col">年月</th>
                <th scope="col">總本金</th>
                <th scope="col">利息</th>
                <th scope="col">總利息</th>
                <th scope="col">總金額</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </body>
</html>
