<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <title>複利計算機</title>
    <script>
      function calculat_compound_interest () {
        $("#result tbody").html('');

        let principal = $("#principal").val() * 1;
        let interest = $("#interest").val() * 1;
        let interest_period = $("#interest_period").val();
        let money_per_period = $("#money_per_period").val() * 1;
        let deposit_years = $("#deposit_years").val() * 1;
        let stop_money_years = $("#stop_money_years").val() * 1

        console.log(principal, interest, interest_period, money_per_period, deposit_years, stop_money_years);


        let calculat_interest = interest_period === 'month' ? (interest/12).toFixed(6) : interest;
        let period_times = interest_period === 'month' ? deposit_years * 12 : deposit_years;
        let stop_money_period = interest_period === 'month' ? stop_money_years * 12 : stop_money_years;

        let total_money = principal;
        let total_principal_money = principal;
        let total_interest_money = 0;

        for (let i = 1 ; i <= period_times ; i++) {
          let temp_interest_money = Math.round(total_money * (calculat_interest));
          total_interest_money += temp_interest_money;

          total_money = total_money + temp_interest_money;
          console.log(convert_period_str(i, interest_period) + ' / 總本金:' + total_principal_money + ' / 此次利息:' + temp_interest_money + ' / 總利息:' + total_interest_money + ' / 總金額:' + total_money);

          result_html = "<tr>";
          result_html += "<th scope='col'>"+ convert_period_str(i, interest_period) +"</th>";
          result_html += "<th scope='col'>"+ total_principal_money +"</th>";
          result_html += "<th scope='col'>"+ temp_interest_money +"</th>";
          result_html += "<th scope='col'>"+ total_interest_money +"</th>";
          result_html += "<th scope='col'>"+ total_money +"</th>";
          result_html += "</tr>";
          $("#result tbody").append(result_html);

          if (stop_money_period < 0 || i < stop_money_period){
            total_money += money_per_period;
            total_principal_money += money_per_period;
          }    
        }
      }

      function convert_period_str(num, period){
        if (period === 'month'){
          return parseInt(num/12) + ' 年 ' + (num%12) + ' 月';
        }else{
          return num + ' 年';
        }
      }
    </script>
  </head>
  <body>
    <div class="container">
      <h1>複利計算機</h1>
      <div class="row">
        <div class="col-sm-3">
          <form>
            <div class="form-group">
              <label for="principal">本金</label>
              <input type="number" class="form-control" value="1000000" id="principal" name="principal" min="1">
            </div>
            <div class="form-group">
              <label for="interest">年利率</label>
              <select class="form-control" id="interest">
                <option value="0.01">1%</option>
                <option value="0.02">2%</option>
                <option value="0.03">3%</option>
                <option value="0.04">4%</option>
                <option value="0.05">5%</option>
                <option value="0.06">6%</option>
                <option value="0.07">7%</option>
                <option value="0.08">8%</option>
                <option value="0.09">9%</option>
                <option value="0.1">10%</option>
                <option value="0.11">11%</option>
                <option value="0.12">12%</option>
                <option value="0.13">13%</option>
                <option value="0.14">14%</option>
                <option value="0.15">15%</option>
                <option value="0.16">16%</option>
                <option value="0.17">17%</option>
                <option value="0.18">18%</option>
                <option value="0.19">19%</option>
                <option value="0.2">20%</option>
              </select>
            </div>
            <div class="form-group">
              <label for="interest_period">每週期複利</label>
              <select class="form-control" id="interest_period">
                <option value="month">每月</option>
                <option value="year">每年</option>
              </select>
            </div>
            <div class="form-group">
              <label for="money_per_period">每週期再投入金額</label>
              <input type="number" class="form-control" value="50000" id="money_per_period" name="money_per_period" min="1">
            </div>
            <div class="form-group">
              <label for="stop_money_years">停止週期再投入</label>
              <select class="form-control" id="stop_money_years">
                <option value="-1">不停止</option>
                <option value="1">1年後</option>
                <option value="2">2年後</option>
                <option value="3">3年後</option>
                <option value="4">4年後</option>
                <option value="5">5年後</option>
                <option value="6">6年後</option>
                <option value="7">7年後</option>
                <option value="8">8年後</option>
                <option value="9">9年後</option>
                <option value="10">10年後</option>
                <option value="11">11年後</option>
                <option value="12">12年後</option>
                <option value="13">13年後</option>
                <option value="14">14年後</option>
                <option value="15">15年後</option>
                <option value="16">16年後</option>
                <option value="17">17年後</option>
                <option value="18">18年後</option>
                <option value="19">19年後</option>
                <option value="20">20年後</option>
                <option value="21">21年後</option>
                <option value="22">22年後</option>
                <option value="23">23年後</option>
                <option value="24">24年後</option>
                <option value="25">25年後</option>
                <option value="26">26年後</option>
                <option value="27">27年後</option>
                <option value="28">28年後</option>
                <option value="29">29年後</option>
                <option value="30">30年後</option>
                <option value="31">31年後</option>
                <option value="32">32年後</option>
                <option value="33">33年後</option>
                <option value="34">34年後</option>
                <option value="35">35年後</option>
                <option value="36">36年後</option>
                <option value="37">37年後</option>
                <option value="38">38年後</option>
                <option value="39">39年後</option>
                <option value="40">40年後</option>
              </select>
            </div>
            <div class="form-group">
              <label for="deposit_years">計算年份</label>
              <input type="number" class="form-control" value="20" id="deposit_years" name="deposit_years" min="1">
            </div>
            
            <button type="button" class="btn btn-primary" onclick="calculat_compound_interest()">計算</button>
          </form>
        </div>
        
        <div class="col-sm-9">
          <table id="result" class="table table-striped table-dark">
            <thead>
              <tr>
                <th scope="col">年月</th>
                <th scope="col">總本金</th>
                <th scope="col">利息</th>
                <th scope="col">總利息</th>
                <th scope="col">總金額</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </body>
</html>
